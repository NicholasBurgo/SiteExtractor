{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/truth.schema.json",
  "title": "Truth Source Record",
  "description": "Normalized business information extracted from website with confidence and provenance",
  "type": "object",
  "required": ["business_id", "domain", "crawled_at", "pages_visited", "fields"],
  "properties": {
    "business_id": {
      "type": "string",
      "description": "Derived slug from domain"
    },
    "domain": {
      "type": "string",
      "description": "Primary domain of the business"
    },
    "crawled_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of crawl"
    },
    "pages_visited": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of pages successfully crawled"
    },
    "fields": {
      "type": "object",
      "description": "Extracted and resolved field values",
      "properties": {
        "brand_name": {"$ref": "#/definitions/stringField"},
        "location": {"$ref": "#/definitions/locationField"},
        "email": {"$ref": "#/definitions/stringField"},
        "phone": {"$ref": "#/definitions/stringField"},
        "socials": {"$ref": "#/definitions/socialsField"},
        "services": {"$ref": "#/definitions/servicesField"},
        "brand_colors": {"$ref": "#/definitions/colorsField"},
        "logo": {"$ref": "#/definitions/stringField"},
        "background": {"$ref": "#/definitions/stringField"},
        "slogan": {"$ref": "#/definitions/stringField"}
      }
    },
    "candidates": {
      "type": "object",
      "description": "All candidates considered during extraction (optional detail)"
    }
  },
  "definitions": {
    "provenance": {
      "type": "object",
      "required": ["url", "path"],
      "properties": {
        "url": {
          "type": "string",
          "description": "Source page URL"
        },
        "path": {
          "type": "string",
          "description": "Extraction method or CSS selector"
        }
      }
    },
    "stringField": {
      "type": "object",
      "required": ["value", "confidence", "provenance"],
      "properties": {
        "value": {
          "type": ["string", "null"],
          "description": "Extracted value or null if not found"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence score 0-1"
        },
        "provenance": {
          "type": "array",
          "items": {"$ref": "#/definitions/provenance"},
          "description": "Source information for this value"
        },
        "notes": {
          "type": "string",
          "description": "Optional validation or extraction notes"
        }
      }
    },
    "locationField": {
      "type": "object",
      "required": ["value", "confidence", "provenance"],
      "properties": {
        "value": {
          "type": ["object", "null"],
          "properties": {
            "street": {"type": ["string", "null"]},
            "city": {"type": ["string", "null"]},
            "region": {"type": ["string", "null"]},
            "postal": {"type": ["string", "null"]},
            "country": {"type": ["string", "null"]},
            "formatted": {"type": ["string", "null"]}
          }
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "provenance": {
          "type": "array",
          "items": {"$ref": "#/definitions/provenance"}
        },
        "notes": {
          "type": "string"
        }
      }
    },
    "socialsField": {
      "type": "object",
      "required": ["value", "confidence", "provenance"],
      "properties": {
        "value": {
          "type": ["object", "null"],
          "properties": {
            "facebook": {"type": ["string", "null"]},
            "instagram": {"type": ["string", "null"]},
            "linkedin": {"type": ["string", "null"]},
            "x": {"type": ["string", "null"]},
            "youtube": {"type": ["string", "null"]},
            "tiktok": {"type": ["string", "null"]},
            "yelp": {"type": ["string", "null"]}
          }
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "provenance": {
          "type": "array",
          "items": {"$ref": "#/definitions/provenance"}
        },
        "notes": {
          "type": "string"
        }
      }
    },
    "servicesField": {
      "type": "object",
      "required": ["value", "confidence", "provenance"],
      "properties": {
        "value": {
          "type": ["array", "null"],
          "items": {"type": "string"},
          "maxItems": 8
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "provenance": {
          "type": "array",
          "items": {"$ref": "#/definitions/provenance"}
        },
        "notes": {
          "type": "string"
        }
      }
    },
    "colorsField": {
      "type": "object",
      "required": ["value", "confidence", "provenance"],
      "properties": {
        "value": {
          "type": ["array", "null"],
          "items": {"type": "string", "pattern": "^#[0-9A-Fa-f]{6}$"},
          "minItems": 1,
          "maxItems": 2
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "provenance": {
          "type": "array",
          "items": {"$ref": "#/definitions/provenance"}
        },
        "notes": {
          "type": "string"
        }
      }
    }
  }
}


