<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Extraction System Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: end;
        }
        
        .input-group input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .input-group label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
            display: block;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .results {
            display: none;
        }
        
        .logo-section {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .logo-section h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .logo-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            margin: 0 auto 20px;
        }
        
        .logo-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .pages-section {
            margin-top: 30px;
        }
        
        .page-card {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .page-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #495057;
        }
        
        .page-url {
            color: #667eea;
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .page-url:hover {
            text-decoration: underline;
        }
        
        .main-page-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 15px;
        }
        
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .image-card {
            background: #fff;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }
        
        .image-preview {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .image-info {
            margin-bottom: 15px;
        }
        
        .image-type {
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .image-alt {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .image-title {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }
        
        .download-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .download-btn:hover {
            background: #218838;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .upload-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .upload-section h3 {
            margin-bottom: 20px;
            color: #495057;
        }
        
        .upload-inputs {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .upload-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .upload-input-group input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .add-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üñºÔ∏è Image Extraction System</h1>
            <p>Extract and organize images from websites with logo detection and page grouping</p>
        </div>
        
        <div class="content">
            <div class="input-section">
                <div class="input-group">
                    <div style="flex: 1;">
                        <label for="url">Website URL</label>
                        <input type="url" id="url" placeholder="https://example.com" value="https://www.northshoreexteriorupkeep.com">
                    </div>
                    <div style="width: 120px;">
                        <label for="maxPages">Max Pages</label>
                        <input type="number" id="maxPages" value="3" min="1" max="10">
                    </div>
                    <button class="btn" onclick="extractImages()">Extract Images</button>
                </div>
            </div>
            
            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Extracting images from website...</p>
            </div>
            
            <div id="error" class="error" style="display: none;"></div>
            
            <div id="results" class="results">
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalImages">0</div>
                        <div class="stat-label">Total Images</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalPages">0</div>
                        <div class="stat-label">Pages Scanned</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="logoFound">No</div>
                        <div class="stat-label">Logo Found</div>
                    </div>
                </div>
                
                <div id="logoSection" class="logo-section" style="display: none;">
                    <h3>üè¢ Website Logo</h3>
                    <img id="logoImage" class="logo-preview" alt="Logo">
                    <div class="logo-info">
                        <p><strong>Confidence:</strong> <span id="logoConfidence"></span>%</p>
                        <p><strong>Source:</strong> <span id="logoSource"></span></p>
                        <p><strong>URL:</strong> <a id="logoUrl" target="_blank" rel="noopener noreferrer">View Original</a></p>
                    </div>
                </div>
                
                <div id="pagesSection" class="pages-section"></div>
                
                <div class="upload-section">
                    <h3>üì§ Upload Additional Images</h3>
                    <div class="upload-inputs" id="uploadInputs">
                        <div class="upload-input-group">
                            <input type="url" placeholder="Enter image URL" class="upload-url">
                            <button class="remove-btn" onclick="removeUploadField(this)" style="display: none;">Remove</button>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="add-btn" onclick="addUploadField()">Add URL</button>
                        <button class="btn" onclick="uploadImages()">Upload Images</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentRunId = null;
        
        async function extractImages() {
            const url = document.getElementById('url').value;
            const maxPages = parseInt(document.getElementById('maxPages').value);
            
            if (!url) {
                showError('Please enter a valid URL');
                return;
            }
            
            showLoading(true);
            hideError();
            hideResults();
            
            try {
                // Simulate API call - in real implementation, this would call your backend
                const response = await simulateImageExtraction(url, maxPages);
                
                if (response.success) {
                    currentRunId = response.runId;
                    displayResults(response.data);
                } else {
                    showError(response.error || 'Failed to extract images');
                }
            } catch (error) {
                showError('Failed to extract images: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        async function simulateImageExtraction(url, maxPages) {
            // This simulates the API call - replace with actual fetch to your backend
            return new Promise((resolve) => {
                setTimeout(() => {
                    // Simulate successful extraction
                    resolve({
                        success: true,
                        runId: 'demo-run-' + Date.now(),
                        data: {
                            logo: {
                                url: 'https://lh3.googleusercontent.com/sitesv/AICyYda9KaRKoURUhaq_Qg_S01QwtlBNX7WjN1ftpcXvq-dLDTsRr83l9aOD_BwYczm1uXNMSskTxx_zGDL7lMHJfzS_n2-Ieq7zcFD1NzVSDsYFVUWXwIKmUFWfUgWqirpQTOaGXXLEWCrrFDqFHVDHm8YSAS-VrnwwTrGNA2TbGaMnGUmiRFB_6_vR2Zo=w16383',
                                confidence: 0.9,
                                source: 'truth_table',
                                preview: {
                                    url: 'https://lh3.googleusercontent.com/sitesv/AICyYda9KaRKoURUhaq_Qg_S01QwtlBNX7WjN1ftpcXvq-dLDTsRr83l9aOD_BwYczm1uXNMSskTxx_zGDL7lMHJfzS_n2-Ieq7zcFD1NzVSDsYFVUWXwIKmUFWfUgWqirpQTOaGXXLEWCrrFDqFHVDHm8YSAS-VrnwwTrGNA2TbGaMnGUmiRFB_6_vR2Zo=w16383',
                                    filename: 'logo.png',
                                    domain: 'lh3.googleusercontent.com',
                                    preview_available: true
                                }
                            },
                            pages: {
                                'https://www.northshoreexteriorupkeep.com': {
                                    title: 'Northshore Exterior Upkeep',
                                    url: 'https://www.northshoreexteriorupkeep.com',
                                    is_main_page: true,
                                    images: [
                                        {
                                            url: 'https://lh3.googleusercontent.com/sitesv/AICyYda9KaRKoURUhaq_Qg_S01QwtlBNX7WjN1ftpcXvq-dLDTsRr83l9aOD_BwYczm1uXNMSskTxx_zGDL7lMHJfzS_n2-Ieq7zcFD1NzVSDsYFVUWXwIKmUFWfUgWqirpQTOaGXXLEWCrrFDqFHVDHm8YSAS-VrnwwTrGNA2TbGaMnGUmiRFB_6_vR2Zo=w16383',
                                            alt_text: 'Pressure washing service',
                                            title: 'Professional Pressure Washing',
                                            type: 'content',
                                            preview: {
                                                url: 'https://lh3.googleusercontent.com/sitesv/AICyYda9KaRKoURUhaq_Qg_S01QwtlBNX7WjN1ftpcXvq-dLDTsRr83l9aOD_BwYczm1uXNMSskTxx_zGDL7lMHJfzS_n2-Ieq7zcFD1NzVSDsYFVUWXwIKmUFWfUgWqirpQTOaGXXLEWCrrFDqFHVDHm8YSAS-VrnwwTrGNA2TbGaMnGUmiRFB_6_vR2Zo=w16383',
                                                filename: 'pressure-washing.jpg',
                                                preview_available: true
                                            }
                                        },
                                        {
                                            url: 'https://lh3.googleusercontent.com/sitesv/AICyYda9KaRKoURUhaq_Qg_S01QwtlBNX7WjN1ftpcXvq-dLDTsRr83l9aOD_BwYczm1uXNMSskTxx_zGDL7lMHJfzS_n2-Ieq7zcFD1NzVSDsYFVUWXwIKmUFWfUgWqirpQTOaGXXLEWCrrFDqFHVDHm8YSAS-VrnwwTrGNA2TbGaMnGUmiRFB_6_vR2Zo=w16383',
                                            alt_text: 'Soft washing service',
                                            title: 'Soft Washing',
                                            type: 'content',
                                            preview: {
                                                url: 'https://lh3.googleusercontent.com/sitesv/AICyYda9KaRKoURUhaq_Qg_S01QwtlBNX7WjN1ftpcXvq-dLDTsRr83l9aOD_BwYczm1uXNMSskTxx_zGDL7lMHJfzS_n2-Ieq7zcFD1NzVSDsYFVUWXwIKmUFWfUgWqirpQTOaGXXLEWCrrFDqFHVDHm8YSAS-VrnwwTrGNA2TbGaMnGUmiRFB_6_vR2Zo=w16383',
                                                filename: 'soft-washing.jpg',
                                                preview_available: true
                                            }
                                        }
                                    ]
                                },
                                'https://www.northshoreexteriorupkeep.com/services': {
                                    title: 'Our Services',
                                    url: 'https://www.northshoreexteriorupkeep.com/services',
                                    is_main_page: false,
                                    images: [
                                        {
                                            url: 'https://lh3.googleusercontent.com/sitesv/AICyYda9KaRKoURUhaq_Qg_S01QwtlBNX7WjN1ftpcXvq-dLDTsRr83l9aOD_BwYczm1uXNMSskTxx_zGDL7lMHJfzS_n2-Ieq7zcFD1NzVSDsYFVUWXwIKmUFWfUgWqirpQTOaGXXLEWCrrFDqFHVDHm8YSAS-VrnwwTrGNA2TbGaMnGUmiRFB_6_vR2Zo=w16383',
                                            alt_text: 'House cleaning service',
                                            title: 'House Cleaning',
                                            type: 'content',
                                            preview: {
                                                url: 'https://lh3.googleusercontent.com/sitesv/AICyYda9KaRKoURUhaq_Qg_S01QwtlBNX7WjN1ftpcXvq-dLDTsRr83l9aOD_BwYczm1uXNMSskTxx_zGDL7lMHJfzS_n2-Ieq7zcFD1NzVSDsYFVUWXwIKmUFWfUgWqirpQTOaGXXLEWCrrFDqFHVDHm8YSAS-VrnwwTrGNA2TbGaMnGUmiRFB_6_vR2Zo=w16383',
                                                filename: 'house-cleaning.jpg',
                                                preview_available: true
                                            }
                                        }
                                    ]
                                }
                            },
                            total_images: 3,
                            extraction_date: new Date().toISOString(),
                            base_url: url
                        }
                    });
                }, 2000); // Simulate 2 second delay
            });
        }
        
        function displayResults(data) {
            // Update stats
            document.getElementById('totalImages').textContent = data.total_images;
            document.getElementById('totalPages').textContent = Object.keys(data.pages).length;
            document.getElementById('logoFound').textContent = data.logo ? 'Yes' : 'No';
            
            // Display logo
            if (data.logo) {
                document.getElementById('logoSection').style.display = 'block';
                document.getElementById('logoImage').src = data.logo.url;
                document.getElementById('logoConfidence').textContent = (data.logo.confidence * 100).toFixed(1);
                document.getElementById('logoSource').textContent = data.logo.source;
                document.getElementById('logoUrl').href = data.logo.url;
            } else {
                document.getElementById('logoSection').style.display = 'none';
            }
            
            // Display pages
            const pagesSection = document.getElementById('pagesSection');
            pagesSection.innerHTML = '';
            
            Object.entries(data.pages).forEach(([pageUrl, pageData]) => {
                const pageCard = document.createElement('div');
                pageCard.className = 'page-card';
                
                pageCard.innerHTML = `
                    <div class="page-header">
                        <div>
                            <div class="page-title">${pageData.title}</div>
                            <a href="${pageUrl}" target="_blank" class="page-url">${pageUrl}</a>
                        </div>
                        ${pageData.is_main_page ? '<span class="main-page-badge">Main Page</span>' : ''}
                    </div>
                    <div class="images-grid">
                        ${pageData.images.map(img => `
                            <div class="image-card">
                                <img src="${img.url}" alt="${img.alt_text}" class="image-preview" onerror="this.style.display='none'">
                                <div class="image-info">
                                    <span class="image-type">${img.type}</span>
                                    ${img.alt_text ? `<div class="image-alt">${img.alt_text}</div>` : ''}
                                    ${img.title ? `<div class="image-title">${img.title}</div>` : ''}
                                </div>
                                <button class="download-btn" onclick="downloadImage('${img.url}', '${img.preview.filename}')">Download</button>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                pagesSection.appendChild(pageCard);
            });
            
            showResults();
        }
        
        function downloadImage(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function addUploadField() {
            const uploadInputs = document.getElementById('uploadInputs');
            const newField = document.createElement('div');
            newField.className = 'upload-input-group';
            newField.innerHTML = `
                <input type="url" placeholder="Enter image URL" class="upload-url">
                <button class="remove-btn" onclick="removeUploadField(this)">Remove</button>
            `;
            uploadInputs.appendChild(newField);
            
            // Show remove buttons if more than one field
            updateRemoveButtons();
        }
        
        function removeUploadField(button) {
            button.parentElement.remove();
            updateRemoveButtons();
        }
        
        function updateRemoveButtons() {
            const fields = document.querySelectorAll('.upload-input-group');
            fields.forEach((field, index) => {
                const removeBtn = field.querySelector('.remove-btn');
                removeBtn.style.display = fields.length > 1 ? 'block' : 'none';
            });
        }
        
        async function uploadImages() {
            const urlInputs = document.querySelectorAll('.upload-url');
            const urls = Array.from(urlInputs).map(input => input.value.trim()).filter(url => url);
            
            if (urls.length === 0) {
                alert('Please enter at least one image URL');
                return;
            }
            
            // Simulate upload
            alert(`Uploading ${urls.length} images...`);
            
            // In real implementation, this would call your backend API
            // const response = await fetch(`/api/image-extraction/${currentRunId}/upload`, {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({ images: urls.map(url => ({ url, type: 'uploaded' })) })
            // });
        }
        
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }
        
        function hideError() {
            document.getElementById('error').style.display = 'none';
        }
        
        function showResults() {
            document.getElementById('results').style.display = 'block';
        }
        
        function hideResults() {
            document.getElementById('results').style.display = 'none';
        }
        
        // Initialize with one upload field
        updateRemoveButtons();
    </script>
</body>
</html>
